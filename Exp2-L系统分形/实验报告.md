# L-System分形生成实验报告

## 一、实验目的

1. 掌握L-System的基本原理和实现方法
2. 理解符号重写规则和状态栈机制(`[]`)的工作原理
3. 实现科赫曲线和分形二叉树的生成与绘制
4. 分析不同参数对分形图形的影响

## 二、实验过程

### 1. 核心算法实现

**L-System字符串生成器(`apply_rules`函数):**
- 输入：公理(axiom)、规则字典(rules)、迭代次数(iterations)
- 处理：通过字符串替换实现迭代生成
- 输出：最终符号串

**L-System绘图器(`draw_l_system`函数):**
- 实现绘图状态管理(位置、角度)
- 处理分支结构(使用栈保存/恢复状态)
- 支持不同绘图指令(F, +, -, [, ]等)

### 2. 分形实现

**科赫曲线参数:**
- 公理: "F"
- 规则: {"F": "F+F--F+F"}
- 角度: 60°
- 迭代次数: 3-4次

**分形树参数:**
- 公理: "0" 
- 规则: {"1": "11", "0": "1[0]0"}
- 角度: 45°
- 迭代次数: 5-7次

### 3. 遇到的问题与解决

（1）状态栈逻辑错误
问题：分形树绘制时，分支恢复后角度计算错误，导致左右分支不对称。
原因：［指令仅保存状态，但未正确处理转向逻辑（题目要求［对应左转，］对应右转）。
解决：在［处先压栈，再执行左转（current_angle += angle）；在］处弹栈后，执行右转（current_angle -= angle），确保分支角度对称。
（2）坐标方向与角度转换
问题：初始角度定义为 “向上”（90°），但math.cos和math.sin以 “向右” 为 0°，导致方向计算错误。
解决：将角度转换为数学坐标系（0° 向右，90° 向上），使用math.radians(current_angle)正确计算极坐标。

## 三、结果展示

### 1. 科赫曲线
![l_system_koch](https://github.com/user-attachments/assets/54617bf9-e543-493f-9795-1dadb6bc0aec)
- 迭代次数对曲线复杂度的影响
迭代 1 次：4 段线段，初始分形结构。
迭代 2 次：16 段线段，尖角细化。
迭代 3 次：64 段线段，曲线更平滑，细节丰富。
- 自相似性特征分析
特征：
自相似性：每一段线段均可视为整体的缩小版。
分形维数：约 1.2618，随迭代次数增加，曲线趋近于无限长的闭合图形（科赫雪花）

### 2. 分形二叉树 
![fractal_tree](https://github.com/user-attachments/assets/a8c2ca31-baa5-4471-a25c-2528b7d4f6b8)
- 分支角度对树形结构的影响
角度 30°：分支更紧凑，树形高耸。
角度 60°：分支更展开，树形宽大。
最佳角度：45° 左右时，树形最接近自然二叉树结构。
- 迭代次数与分支密度的关系
迭代次数越多，分形树的分支密度越高，分支数量呈指数级增长，树形结构更复杂茂密；反之，迭代次数越少，分支密度越低，结构越简单稀疏。

## 四、分析与思考

1. **L-System特性分析**
   - 字符串重写与图形生成的对应关系
     
     符号F对应 “绘制线段”，+/-对应 “角度变换”，[/]对应 “状态栈操作”，通过规则迭代将简单字符串转换为复杂几何结构。
     
   - 栈结构在分支处理中的作用
     
     在分形树中，[用于保存当前位置和角度（分支起点），]用于恢复状态（返回分支点），实现递归分支逻辑，避免显式递归调用，提升效率。

2. **参数影响实验**
   - 不同角度参数的效果对比
   - 迭代次数与计算复杂度的关系

（1）迭代次数

科赫曲线：次数越高，线段数量呈 4^n 增长，曲线趋近于无限细节（但受限于绘图精度）。
分形树：次数决定分支层数，层数过高会导致计算时间指数级增长（线段数约 2^n）。

（2）角度参数

科赫曲线：60° 是形成等边三角形的关键，角度变化会破坏自相似性。
分形树：角度决定分支张开程度，随机角度（如 ±5° 波动）可使树形更自然。

3. **扩展思考**
   - 如何添加随机性使分形更自然
   
   在规则中添加随机角度或步长（如0 → 1[+0]0[-0]），使分支角度略有差异，模拟自然生长的不确定性。
   
   - 其他经典分形的L-System规则设计
   
   龙曲线：公理FX，规则X→X+YF+, Y→-FX-Y，角度 90°。
   雪花：科赫曲线闭合版本，初始公理F++F++F，规则同上。
   
   - 与迭代函数系统(IFS)方法的比较
   
   L-System：适合分支结构（树、珊瑚），通过符号重写和栈机制实现层次化生长。
   IFS：适合碎片状分形（康托集、Sierpiński 三角形），通过仿射变换迭代生成。

5. **算法优化**
   - 提高绘图效率的方法
   - 大规模分形渲染的优化思路

预计算指令字符串：避免重复生成字符串，直接缓存中间结果。

向量化绘图：使用矩阵运算批量计算坐标，减少循环次数（适合大规模分形）。

多线程渲染：分段绘制复杂图形，提升绘图效率。

**注：请在每一部分补充你自己的实验内容、图像、分析和关键代码。**
